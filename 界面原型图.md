# å¹¸è¿å’–äº§å“æˆæœ¬è®¡ç®—å™¨ - ç•Œé¢åŸå‹å›¾

## ä¸€ã€é¦–é¡µç•Œé¢åŸå‹

### 1.1 åˆå§‹çŠ¶æ€ï¼ˆæ— æœç´¢ï¼‰

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  å¹¸è¿å’–äº§å“æˆæœ¬è®¡ç®—å™¨                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ ğŸ” æœç´¢äº§å“æˆ–ç‰©æ–™...            â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ â˜• æ‹¿é“å’–å•¡                      â”‚ â•‘
â•‘  â”‚ ğŸ’° æˆæœ¬ï¼šÂ¥8.50                  â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ â˜• ç¾å¼å’–å•¡                      â”‚ â•‘
â•‘  â”‚ ğŸ’° æˆæœ¬ï¼šÂ¥5.20                  â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ ğŸ¥› çº¯ç‰›å¥¶                       â”‚ â•‘
â•‘  â”‚ ğŸ“¦ 1000ml / Â¥30.00              â”‚ â•‘
â•‘  â”‚ ğŸ’µ å•ä½æˆæœ¬ï¼šÂ¥0.03/ml            â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 1.2 æœç´¢çŠ¶æ€ï¼ˆæœ‰ç»“æœï¼‰

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  å¹¸è¿å’–äº§å“æˆæœ¬è®¡ç®—å™¨                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ ğŸ” æ‹¿é“                          â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  æ‰¾åˆ° 1 ä¸ªç»“æœ                         â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ â˜• æ‹¿é“å’–å•¡                      â”‚ â•‘
â•‘  â”‚ ğŸ’° æˆæœ¬ï¼šÂ¥8.50                  â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 1.3 æœç´¢æ— ç»“æœ

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  å¹¸è¿å’–äº§å“æˆæœ¬è®¡ç®—å™¨                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ ğŸ” xxxxxx                        â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                        â•‘
â•‘          ğŸ˜” æœªæ‰¾åˆ°ç›¸å…³ç»“æœ              â•‘
â•‘                                        â•‘
â•‘      è¯·å°è¯•å…¶ä»–å…³é”®è¯æœç´¢               â•‘
â•‘                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## äºŒã€äº§å“è¯¦æƒ…é¡µåŸå‹

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  â† è¿”å›                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                        â•‘
â•‘         â˜• æ‹¿é“å’–å•¡                     â•‘
â•‘                                        â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
â•‘                                        â•‘
â•‘        æ€»æˆæœ¬ï¼šÂ¥8.50                   â•‘
â•‘                                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  æˆæœ¬æ˜ç»†ï¼š                            â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
â•‘                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ çº¯ç‰›å¥¶                           â”‚ â•‘
â•‘  â”‚ 200ml Ã— Â¥0.03/ml = Â¥6.00       â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ å’–å•¡è±†                           â”‚ â•‘
â•‘  â”‚ 50g Ã— Â¥0.05/g = Â¥2.50          â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                        â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
â•‘  â”‚ ç³–æµ†                             â”‚ â•‘
â•‘  â”‚ 10ml Ã— Â¥0.00/ml = Â¥0.00        â”‚ â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
â•‘                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ä¸‰ã€ç‰©æ–™è¯¦æƒ…é¡µåŸå‹

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  â† è¿”å›                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                        â•‘
â•‘         ğŸ¥› çº¯ç‰›å¥¶                      â•‘
â•‘                                        â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
â•‘                                        â•‘
â•‘  è§„æ ¼ä¿¡æ¯ï¼š                            â•‘
â•‘                                        â•‘
â•‘  è§„æ ¼æ•°é‡ï¼š1000ml                      â•‘
â•‘  è§„æ ¼ä»·æ ¼ï¼šÂ¥30.00                      â•‘
â•‘                                        â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
â•‘                                        â•‘
â•‘  å•ä½æˆæœ¬ï¼šÂ¥0.03/ml                    â•‘
â•‘                                        â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â•‘
â•‘                                        â•‘
â•‘  åˆ†ç±»ï¼šåŸæ–™                            â•‘
â•‘                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## å››ã€WXML ç»“æ„å‚è€ƒ

### 4.1 é¦–é¡µç»“æ„

```xml
<!-- index.wxml -->
<view class="container">
  <!-- æœç´¢æ¡† -->
  <view class="search-box">
    <input 
      class="search-input" 
      placeholder="ğŸ” æœç´¢äº§å“æˆ–ç‰©æ–™..."
      value="{{searchKeyword}}"
      bindinput="onSearchInput"
    />
  </view>
  
  <!-- ç»“æœåˆ—è¡¨ -->
  <view class="result-list">
    <!-- äº§å“é¡¹ -->
    <view 
      wx:for="{{productResults}}" 
      wx:key="_id"
      class="result-item product-item"
      bindtap="goToProductDetail"
      data-item="{{item}}"
    >
      <view class="item-icon">â˜•</view>
      <view class="item-content">
        <view class="item-name">{{item.name}}</view>
        <view class="item-cost">ğŸ’° æˆæœ¬ï¼šÂ¥{{item.totalCost}}</view>
      </view>
      <view class="item-arrow">></view>
    </view>
    
    <!-- ç‰©æ–™é¡¹ -->
    <view 
      wx:for="{{materialResults}}" 
      wx:key="_id"
      class="result-item material-item"
      bindtap="goToMaterialDetail"
      data-item="{{item}}"
    >
      <view class="item-icon">ğŸ¥›</view>
      <view class="item-content">
        <view class="item-name">{{item.name}}</view>
        <view class="item-spec">
          ğŸ“¦ {{item.spec_amount}}{{item.spec_unit}} / Â¥{{item.spec_price}}
        </view>
        <view class="item-unit-cost">
          ğŸ’µ å•ä½æˆæœ¬ï¼šÂ¥{{item.unitPrice}}/{{item.spec_unit}}
        </view>
      </view>
      <view class="item-arrow">></view>
    </view>
    
    <!-- æ— ç»“æœæç¤º -->
    <view wx:if="{{hasNoResult}}" class="no-result">
      <text>ğŸ˜” æœªæ‰¾åˆ°ç›¸å…³ç»“æœ</text>
      <text>è¯·å°è¯•å…¶ä»–å…³é”®è¯æœç´¢</text>
    </view>
  </view>
</view>
```

### 4.2 äº§å“è¯¦æƒ…é¡µç»“æ„

```xml
<!-- detail.wxml (äº§å“) -->
<view class="container">
  <view class="header">
    <view class="back-btn" bindtap="goBack">â† è¿”å›</view>
  </view>
  
  <view class="detail-content">
    <view class="product-title">
      <text class="icon">â˜•</text>
      <text class="name">{{product.name}}</text>
    </view>
    
    <view class="divider"></view>
    
    <view class="total-cost">
      <text>æ€»æˆæœ¬ï¼šÂ¥{{costInfo.totalCost}}</text>
    </view>
    
    <view class="divider"></view>
    
    <view class="cost-details">
      <view class="section-title">æˆæœ¬æ˜ç»†ï¼š</view>
      <view 
        wx:for="{{costInfo.details}}" 
        wx:key="index"
        class="detail-item"
      >
        <view class="detail-name">{{item.materialName}}</view>
        <view class="detail-calculation">
          {{item.amount}}{{item.unit}} Ã— Â¥{{item.unitPrice}}/{{item.unit}} = Â¥{{item.itemCost}}
        </view>
      </view>
    </view>
  </view>
</view>
```

### 4.3 ç‰©æ–™è¯¦æƒ…é¡µç»“æ„

```xml
<!-- detail.wxml (ç‰©æ–™) -->
<view class="container">
  <view class="header">
    <view class="back-btn" bindtap="goBack">â† è¿”å›</view>
  </view>
  
  <view class="detail-content">
    <view class="material-title">
      <text class="icon">ğŸ¥›</text>
      <text class="name">{{material.name}}</text>
    </view>
    
    <view class="divider"></view>
    
    <view class="spec-info">
      <view class="info-title">è§„æ ¼ä¿¡æ¯ï¼š</view>
      <view class="info-item">
        <text>è§„æ ¼æ•°é‡ï¼š{{material.spec_amount}}{{material.spec_unit}}</text>
      </view>
      <view class="info-item">
        <text>è§„æ ¼ä»·æ ¼ï¼šÂ¥{{material.spec_price}}</text>
      </view>
    </view>
    
    <view class="divider"></view>
    
    <view class="unit-cost">
      <text>å•ä½æˆæœ¬ï¼šÂ¥{{unitPrice}}/{{material.spec_unit}}</text>
    </view>
    
    <view class="divider"></view>
    
    <view class="category">
      <text>åˆ†ç±»ï¼š{{material.category === 'material' ? 'åŸæ–™' : 'åŒ…è£…'}}</text>
    </view>
  </view>
</view>
```

## äº”ã€æ•°æ®æµç¤ºæ„å›¾

### 5.1 é¦–é¡µæ•°æ®æµ

```
Page({
  data: {
    searchKeyword: '',        // æœç´¢å…³é”®è¯
    allProducts: [],          // æ‰€æœ‰äº§å“æ•°æ®
    allMaterials: [],         // æ‰€æœ‰ç‰©æ–™æ•°æ®
    productResults: [],       // äº§å“æœç´¢ç»“æœ
    materialResults: [],      // ç‰©æ–™æœç´¢ç»“æœ
    hasNoResult: false       // æ˜¯å¦æ— ç»“æœ
  },
  
  onLoad() {
    // 1. æ‹‰å–ç‰©æ–™æ•°æ®
    this.loadMaterials();
    // 2. æ‹‰å–äº§å“æ•°æ®
    this.loadProducts();
  },
  
  loadMaterials() {
    // ä»äº‘æ•°æ®åº“æ‹‰å– materials
    // è®¡ç®—æ¯ä¸ªç‰©æ–™çš„å•ä½æˆæœ¬
    // å­˜å‚¨åˆ° allMaterials
  },
  
  loadProducts() {
    // ä»äº‘æ•°æ®åº“æ‹‰å– products
    // å®æ—¶è®¡ç®—æ¯ä¸ªäº§å“çš„æ€»æˆæœ¬
    // å­˜å‚¨åˆ° allProducts
  },
  
  onSearchInput(e) {
    // 1. è·å–æœç´¢å…³é”®è¯
    // 2. åœ¨äº§å“åˆ—è¡¨ä¸­æœç´¢
    // 3. åœ¨ç‰©æ–™åˆ—è¡¨ä¸­æœç´¢
    // 4. æ›´æ–° productResults å’Œ materialResults
  }
})
```

### 5.2 è¯¦æƒ…é¡µæ•°æ®æµ

```
Page({
  data: {
    type: 'product',          // 'product' æˆ– 'material'
    product: null,            // äº§å“æ•°æ®
    material: null,           // ç‰©æ–™æ•°æ®
    costInfo: null,           // æˆæœ¬ä¿¡æ¯ï¼ˆäº§å“ç”¨ï¼‰
    unitPrice: 0              // å•ä½æˆæœ¬ï¼ˆç‰©æ–™ç”¨ï¼‰
  },
  
  onLoad(options) {
    // 1. è·å–ä¼ å…¥çš„ type å’Œ id
    // 2. å¦‚æœæ˜¯äº§å“ï¼Œæ‹‰å–äº§å“æ•°æ®å¹¶è®¡ç®—æˆæœ¬
    // 3. å¦‚æœæ˜¯ç‰©æ–™ï¼Œæ‹‰å–ç‰©æ–™æ•°æ®å¹¶è®¡ç®—å•ä½æˆæœ¬
  },
  
  calculateProductCost() {
    // 1. è·å–äº§å“çš„ recipe
    // 2. éå† recipeï¼ŒæŸ¥æ‰¾å¯¹åº”ç‰©æ–™
    // 3. è®¡ç®—æ¯ä¸ªé…æ–™çš„æˆæœ¬
    // 4. ç´¯åŠ å¾—åˆ°æ€»æˆæœ¬
  }
})
```

## å…­ã€å…³é”®å‡½æ•°ä¼ªä»£ç 

### 6.1 æˆæœ¬è®¡ç®—å‡½æ•°

```javascript
// utils/calculator.js

/**
 * è®¡ç®—ç‰©æ–™å•ä½æˆæœ¬
 */
function getUnitPrice(material) {
  return material.spec_price / material.spec_amount;
}

/**
 * è®¡ç®—äº§å“æ€»æˆæœ¬
 */
function calculateProductCost(product, materialsMap) {
  let totalCost = 0;
  const details = [];
  
  product.recipe.forEach(recipeItem => {
    // æŸ¥æ‰¾ç‰©æ–™
    const material = materialsMap[recipeItem.material_id];
    if (!material) return;
    
    // è®¡ç®—å•ä½æˆæœ¬
    const unitPrice = getUnitPrice(material);
    
    // è®¡ç®—è¯¥é¡¹æˆæœ¬
    const itemCost = recipeItem.amount * unitPrice;
    
    // ç´¯åŠ 
    totalCost += itemCost;
    
    // è®°å½•æ˜ç»†
    details.push({
      materialName: material.name,
      amount: recipeItem.amount,
      unit: material.spec_unit,
      unitPrice: parseFloat(unitPrice.toFixed(4)),
      itemCost: parseFloat(itemCost.toFixed(2))
    });
  });
  
  return {
    totalCost: parseFloat(totalCost.toFixed(2)),
    details: details
  };
}

/**
 * å°†ç‰©æ–™æ•°ç»„è½¬æ¢ä¸º Mapï¼Œæé«˜æŸ¥æ‰¾æ•ˆç‡
 */
function buildMaterialsMap(materials) {
  const map = {};
  materials.forEach(material => {
    map[material._id] = material;
  });
  return map;
}
```

### 6.2 æœç´¢å‡½æ•°

```javascript
/**
 * æœç´¢äº§å“å’Œç‰©æ–™
 */
function searchItems(keyword, products, materials, materialsMap) {
  const keywordLower = keyword.toLowerCase();
  
  // æœç´¢äº§å“
  const productResults = products
    .filter(product => 
      product.name.toLowerCase().includes(keywordLower)
    )
    .map(product => {
      // å®æ—¶è®¡ç®—æˆæœ¬
      const costInfo = calculateProductCost(product, materialsMap);
      return {
        ...product,
        totalCost: costInfo.totalCost
      };
    });
  
  // æœç´¢ç‰©æ–™
  const materialResults = materials
    .filter(material => 
      material.name.toLowerCase().includes(keywordLower)
    )
    .map(material => {
      // è®¡ç®—å•ä½æˆæœ¬
      const unitPrice = getUnitPrice(material);
      return {
        ...material,
        unitPrice: parseFloat(unitPrice.toFixed(4))
      };
    });
  
  return {
    productResults,
    materialResults,
    hasNoResult: productResults.length === 0 && materialResults.length === 0
  };
}
```

## ä¸ƒã€æ ·å¼è§„èŒƒï¼ˆWXSSï¼‰

### 7.1 åŸºç¡€æ ·å¼

```css
/* å®¹å™¨ */
.container {
  padding: 30rpx;
  background-color: #F5F5F5;
  min-height: 100vh;
}

/* æœç´¢æ¡† */
.search-box {
  margin-bottom: 30rpx;
}

.search-input {
  width: 100%;
  height: 80rpx;
  background: #FFFFFF;
  border-radius: 10rpx;
  padding: 0 30rpx;
  font-size: 28rpx;
}

/* ç»“æœåˆ—è¡¨ */
.result-list {
  display: flex;
  flex-direction: column;
  gap: 20rpx;
}

/* åˆ—è¡¨é¡¹ */
.result-item {
  background: #FFFFFF;
  border-radius: 10rpx;
  padding: 30rpx;
  display: flex;
  align-items: center;
}

.item-icon {
  font-size: 48rpx;
  margin-right: 20rpx;
}

.item-content {
  flex: 1;
}

.item-name {
  font-size: 32rpx;
  font-weight: bold;
  color: #333333;
  margin-bottom: 10rpx;
}

.item-cost, .item-spec, .item-unit-cost {
  font-size: 24rpx;
  color: #666666;
}

.item-arrow {
  font-size: 32rpx;
  color: #CCCCCC;
}
```

### 7.2 è¯¦æƒ…é¡µæ ·å¼

```css
/* è¯¦æƒ…é¡µ */
.detail-content {
  background: #FFFFFF;
  border-radius: 10rpx;
  padding: 40rpx;
}

.product-title, .material-title {
  text-align: center;
  font-size: 36rpx;
  font-weight: bold;
  margin-bottom: 30rpx;
}

.divider {
  height: 1rpx;
  background: #E5E5E5;
  margin: 30rpx 0;
}

.total-cost {
  text-align: center;
  font-size: 48rpx;
  color: #FF6B35;
  font-weight: bold;
}

.cost-details {
  margin-top: 30rpx;
}

.detail-item {
  background: #F9F9F9;
  border-radius: 8rpx;
  padding: 20rpx;
  margin-bottom: 20rpx;
}

.detail-name {
  font-size: 28rpx;
  font-weight: bold;
  margin-bottom: 10rpx;
}

.detail-calculation {
  font-size: 24rpx;
  color: #666666;
}
```

## å…«ã€é¡µé¢è·³è½¬å‚æ•°

### 8.1 è·³è½¬åˆ°äº§å“è¯¦æƒ…

```javascript
// index.js
goToProductDetail(e) {
  const product = e.currentTarget.dataset.item;
  wx.navigateTo({
    url: `/pages/detail/detail?type=product&id=${product._id}`
  });
}
```

### 8.2 è·³è½¬åˆ°ç‰©æ–™è¯¦æƒ…

```javascript
// index.js
goToMaterialDetail(e) {
  const material = e.currentTarget.dataset.item;
  wx.navigateTo({
    url: `/pages/detail/detail?type=material&id=${material._id}`
  });
}
```

### 8.3 è¯¦æƒ…é¡µæ¥æ”¶å‚æ•°

```javascript
// detail.js
onLoad(options) {
  const { type, id } = options;
  
  if (type === 'product') {
    this.loadProduct(id);
  } else if (type === 'material') {
    this.loadMaterial(id);
  }
}
```

---

**å¼€å‘æ£€æŸ¥æ¸…å•ï¼š**
- [ ] äº‘æ•°æ®åº“ collections åˆ›å»ºï¼ˆmaterials, productsï¼‰
- [ ] æ•°æ®åº“æƒé™è®¾ç½®ï¼ˆæ‰€æœ‰ç”¨æˆ·å¯è¯»ï¼‰
- [ ] é¦–é¡µæœç´¢åŠŸèƒ½å®ç°
- [ ] äº§å“è¯¦æƒ…é¡µæˆæœ¬è®¡ç®—
- [ ] ç‰©æ–™è¯¦æƒ…é¡µå•ä½æˆæœ¬è®¡ç®—
- [ ] æ•°æ®æ‹‰å–å’Œé”™è¯¯å¤„ç†
- [ ] é¡µé¢è·³è½¬å’Œè¿”å›
- [ ] æ ·å¼ç¾åŒ–
- [ ] æµ‹è¯•æ•°æ®å‡†å¤‡

